<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Detail Gunung - PorterIn</title>
  <meta name="description" content="Detail informasi paket pendakian gunung terbaik di Indonesia">
  <meta name="keywords" content="detail gunung, pendakian gunung, paket wisata, porter, indonesia">

  <!-- Favicons -->
  <link href="assets/img/icon-lagi1.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
    :root {
      --accent-color: #009961;
      --secondary-color: #4a7c59;
      --tertiary-color: #ff6b35;
    }

    .wishlist-icon, .cart-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.3s ease-in-out;
      background: transparent;
    }

    .wishlist-icon:hover, .cart-icon:hover {
      color: #ffffff;
      background: var(--accent-color);
      box-shadow: 0 0 12px 3px rgba(0, 153, 97, 0.4);
      transform: rotate(8deg) scale(1.2);
    }

    .wishlist-count, .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--tertiary-color);
      color: #fff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transition: all 0.3s ease;
    }

    .wishlist-icon:hover .wishlist-count,
    .cart-icon:hover .cart-count {
      transform: scale(1.3) rotate(10deg);
      box-shadow: 0 2px 10px rgba(0, 153, 97, 0.6);
    }
    
    .page-title {
      background: url('assets/img/gunung.jpg') no-repeat;
      background-size: cover;
      background-position: center;
      padding: 120px 0 80px 0;
      color: white;
    }

    .mountain-hero {
      height: 500px;
      background-size: cover;
      background-position: center;
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    .mountain-hero-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      padding: 40px 30px 30px;
      color: white;
    }

    .difficulty-badge {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: white;
    }

    .difficulty-Pemula { background: #28a745; }
    .difficulty-Menengah { background: #ffc107; color: #212529; }
    .difficulty-Ekstrem { background: #dc3545; }

    .price-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: 700;
    }

    .info-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 5px solid var(--accent-color);
    }

    .info-card h4 {
      color: var(--accent-color);
      margin-bottom: 20px;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .feature-list li:last-child {
      border-bottom: none;
    }

    .feature-list i {
      color: var(--accent-color);
      margin-right: 10px;
      width: 20px;
    }

    .itinerary-day {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid var(--accent-color);
    }

    .itinerary-day h6 {
      color: var(--accent-color);
      font-weight: 700;
      margin-bottom: 10px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .gallery-item {
      height: 200px;
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .gallery-item:hover {
      transform: scale(1.05);
    }

    .booking-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      position: sticky;
      top: 100px;
    }

    .btn-book-main {
      background: var(--accent-color);
      border: none;
      color: white;
      padding: 15px 40px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 18px;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      width: 100%;
    }

    .btn-book-main:hover {
      background: var(--secondary-color);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .btn-wishlist {
      background: white;
      border: 2px solid var(--accent-color);
      color: var(--accent-color);
      padding: 15px 30px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 18px;
      transition: all 0.3s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      width: 100%;
      margin-top: 15px;
    }

    .btn-wishlist:hover {
      background: var(--accent-color);
      color: white;
    }

    .btn-wishlist.active {
      background: var(--tertiary-color);
      border-color: var(--tertiary-color);
      color: white;
    }

    .calendar-container {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .calendar-day {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .calendar-day.available {
      background: #d1e7dd;
      color: #0f5132;
    }

    .calendar-day.available:hover {
      background: var(--accent-color);
      color: white;
    }

    .calendar-day.busy {
      background: #f8d7da;
      color: #842029;
      cursor: not-allowed;
    }

    .calendar-day.selected {
      background: var(--accent-color);
      color: white;
    }

    .testimonial-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .custom-notification {
      position: fixed;
      top: -150px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      z-index: 10000;
      transition: top 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s;
      opacity: 0;
      min-width: 350px;
    }

    .custom-notification.show {
      top: 20px;
      opacity: 1;
    }

    .custom-notification .icon {
      font-size: 24px;
      margin-right: 15px;
    }
    
    .custom-notification.success {
      background-color: #28a745;
      color: white;
    }
    
     .custom-notification.info {
      background-color: #dc3545;
      color: white;
    }

    .custom-notification.error {
      background-color: #ffc107;
      color: #333;
    }

    .breadcrumbs {
      margin-top: 20px;
    }

    .breadcrumbs ol {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .breadcrumbs ol li {
      margin-right: 10px;
    }

    .breadcrumbs ol li:last-child:after {
      content: "";
    }

    .breadcrumbs ol li a {
      color: rgba(255,255,255,0.8);
      text-decoration: none;
    }

    .breadcrumbs ol li a:hover {
      color: white;
    }

    .breadcrumbs ol li.current {
      color: white;
    }

    .rating-stars {
      color: #ffc107;
      margin-bottom: 10px;
    }

    .rating-stars i {
      font-size: 16px;
    }

    .review-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .review-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 15px;
    }

    .tabs-nav {
      border-bottom: 2px solid #eee;
      margin-bottom: 30px;
    }

    .tab-button {
      background: none;
      border: none;
      padding: 15px 25px;
      font-weight: 600;
      color: #6c757d;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .tab-button.active {
      color: var(--accent-color);
      border-bottom-color: var(--accent-color);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Tambahan styling untuk tombol ulasan */
    .btn-review-submit {
      background: var(--accent-color, #009961);
      border: none;
      color: #fff;
      border-radius: 25px;
      font-weight: 600;
      padding: 8px 28px;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(0,153,97,0.08);
    }
    .btn-review-submit:hover, .btn-review-submit:focus {
      background: var(--secondary-color, #4a7c59);
      color: #fff;
      box-shadow: 0 4px 16px rgba(0,153,97,0.18);
    }
  </style>
</head>

<body class="mountain-detail-page">
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">PorterIn</h1>
      </a>
      <div class="d-flex align-items-center order-2 order-xl-3 me-2">
        <a href="wishlist.html" class="me-2 position-relative wishlist-icon">
          <i class="bi bi-heart-fill fs-5"></i>
          <span class="wishlist-count" id="wishlist-count-header">0</span>
        </a>
        <a href="cart.html" class="me-2 position-relative cart-icon">
          <i class="bi bi-bag-check-fill fs-5"></i>
          <span class="cart-count" id="cart-count-header">0</span>
        </a>
      </div>
      <nav id="navmenu" class="navmenu order-3 order-xl-2">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#about">About</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li class="dropdown"><a href="#" class="active"><span>Produk</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="katalog-gunung.html" class="active">Katalog Gunung</a></li>
              <li><a href="katalog-porter.html">Porter</a></li>
              <li><a href="katalog-gear.html">Sewa Gear Pendakian</a></li>
              <li><a href="#">Simulasi Pendakian</a></li>
            </ul>
          </li>
          <li><a href="index.html#contact">Contact</a></li>
          <li><a href="index.html#history">History</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>

  <!-- Notification Element -->
  <div id="custom-notification" class="custom-notification">
    <div id="notification-icon" class="icon"></div>
    <div id="notification-message"></div>
  </div>

  <main class="main">
    <div class="page-title dark-background" data-aos="fade" style="background-image: url('assets/img/gunung.jpg');">
      <div class="container position-relative">
        <h1 id="mountain-name-title">Detail Gunung</h1>
        <p>Informasi lengkap paket pendakian untuk petualangan tak terlupakan</p>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li><a href="katalog-gunung.html">Katalog Gunung</a></li>
            <li class="current" id="mountain-breadcrumb-name">Detail Gunung</li>
          </ol>
        </nav>

      </div>
    </div>

    <section class="section">
      <div class="container" id="mountain-details-container">
        <div class="row justify-content-center text-center">
             <div class="col-lg-8">
                <p>Memuat detail paket...</p>
             </div>
        </div>
      </div>
    </section>
  </main>

  <footer id="footer" class="footer dark-background">
     <div class="container">
      <h3 class="sitename">PorterIn</h3>
      <p>Platform terpercaya untuk petualangan pendakian gunung di Indonesia. Wujudkan impian mendaki Anda bersama kami.</p>
      <div class="social-links d-flex justify-content-center">
        <a href=""><i class="bi bi-twitter-x"></i></a>
        <a href=""><i class="bi bi-facebook"></i></a>
        <a href=""><i class="bi bi-instagram"></i></a>
        <a href=""><i class="bi bi-youtube"></i></a>
        <a href=""><i class="bi bi-linkedin"></i></a>
      </div>
      <div class="container">
        <div class="copyright">
          <span>Copyright</span> <strong class="px-1 sitename">PorterIn</strong> <span>All Rights Reserved</span>
        </div>
        <div class="credits">
          Designed with <i class="bi bi-heart-fill text-danger"></i> for Mountain Lovers
        </div>
      </div>
    </div>
  </footer>

  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const getQueryParam = (param) => new URLSearchParams(window.location.search).get(param);
        const mountainId = getQueryParam('id');

        if (!mountainId) {
            renderNotFound(document.getElementById('mountain-details-container'), "ID paket tidak valid atau tidak ditemukan di URL.");
            return;
        }

        const mountains = JSON.parse(localStorage.getItem('mountains')) || [];
        const mountain = mountains.find(m => m.id === mountainId); 
        
        const container = document.getElementById('mountain-details-container');
        if (!container) return;

        if (mountain) {
          renderMountainDetails(mountain, container);
          initializePageFunctionality(mountain);
        } else {
          renderNotFound(container, `Paket dengan ID ${mountainId} tidak ditemukan.`);
        }
      } catch (error) {
        console.error("Gagal memuat detail paket:", error);
        const container = document.getElementById('mountain-details-container');
        if(container) renderNotFound(container, "Terjadi kesalahan saat memuat data.");
      }
    });

    function renderMountainDetails(mountain, container) {
      document.title = `Detail: ${mountain.name} - PorterIn`;

      const pageTitle = document.querySelector('.page-title');
      if (pageTitle) {
        pageTitle.style.backgroundImage = `url('${mountain.image || 'assets/img/gunung.jpg'}')`;
      }

      document.getElementById('mountain-name-title').textContent = mountain.name;

      container.innerHTML = `
        <div class="row gy-5 gx-4">
          <div class="col-lg-8" id="main-content-column">
            <!-- Main content will be rendered here -->
          </div>
          <div class="col-lg-4" id="sidebar-column">
            <!-- Sidebar will be rendered here -->
          </div>
        </div>
      `;

      renderMainContent(mountain, document.getElementById('main-content-column'));
      renderBookingSidebar(mountain, document.getElementById('sidebar-column'));
    }

    function renderMainContent(mountain, container) {
      const imageSrc = mountain.image || `https://placehold.co/800x500/cccccc/ffffff?text=${encodeURIComponent(mountain.name)}`;
      const difficultyClass = `difficulty-${mountain.difficulty.replace(/\s+/g, '')}`;

      // --- Ulasan ---
      let reviewsHTML = '';
      let reviews = [];
      try {
        reviews = typeof mountain.reviews === 'string' ? JSON.parse(mountain.reviews) : mountain.reviews;
      } catch (e) {
        reviews = [];
      }
      if (Array.isArray(reviews) && reviews.length > 0) {
        reviewsHTML = reviews.map(r => `
          <div class="review-card d-flex mb-3 p-3 align-items-start">
            <img src="${r.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(r.name || 'User')}" class="review-avatar me-3" alt="${r.name || 'User'}">
            <div>
              <strong>${r.name || 'Anonim'}</strong>
              <div class="rating-stars mb-1">
                ${'<i class="bi bi-star-fill"></i>'.repeat(r.rating || 5)}
              </div>
              <div class="review-body">
                <p class="mb-0">${r.comment || ''}</p>
              </div>
            </div>
          </div>
        `).join('');
      } else {
        reviewsHTML = `<div class="info-card"><p>Ulasan belum tersedia.</p></div>`;
      }

      // --- Galeri ---
      let galleryHTML = '';
      if (Array.isArray(mountain.gallery) && mountain.gallery.length > 0) {
        galleryHTML = `
          <div class="gallery-grid mb-3">
            ${mountain.gallery.map(img => `<div class="gallery-item border" style="background-image:url('${img}')"></div>`).join('')}
          </div>
        `;
      } else {
        galleryHTML = `<p class="text-muted">Galeri belum tersedia.</p>`;
      }

      // --- Tabs ---
      const tabsHTML = `
        <div class="tabs-nav mb-4" data-aos="fade-up" data-aos-delay="100">
          <button class="tab-button active" data-tab="overview">Overview</button>
          <button class="tab-button" data-tab="itinerary">Itinerary</button>
          <button class="tab-button" data-tab="gallery">Galeri</button>
          <button class="tab-button" data-tab="reviews">Ulasan</button>
        </div>
        <div id="overview" class="tab-content active">
          <div class="info-card mb-4">
            <h4><i class="bi bi-mountain me-2"></i>Tentang Gunung</h4>
            <p>${mountain.description || 'Deskripsi untuk paket ini belum tersedia.'}</p>
          </div>
          <div class="weather-info info-card mb-4" data-aos="fade-up" data-aos-delay="200">
            <h6><i class="bi bi-cloud-sun me-2"></i>Info Cuaca</h6>
            <div class="row">
              <div class="col-6 col-md-3"><span class="fw-bold">Suhu Siang:</span><br>15-20°C</div>
              <div class="col-6 col-md-3"><span class="fw-bold">Suhu Malam:</span><br>5-10°C</div>
              <div class="col-6 col-md-3"><span class="fw-bold">Kelembaban:</span><br>70-85%</div>
              <div class="col-6 col-md-3"><span class="fw-bold">Musim Terbaik:</span><br>Apr - Sep</div>
            </div>
          </div>
        </div>
        <div id="itinerary" class="tab-content">
          <div class="info-card"><p>Itinerary belum tersedia.</p></div>
        </div>
        <div id="gallery" class="tab-content">
          <div class="info-card">
            <form id="gallery-form" class="mb-3 p-3 bg-light rounded border">
              <label for="gallery-photo" class="form-label fw-bold">Upload Foto Pendakian Anda:</label>
              <input type="file" id="gallery-photo" accept="image/*" class="form-control mb-2" required>
              <button type="submit" class="btn btn-success btn-sm">Tambah Foto</button>
            </form>
            ${galleryHTML}
          </div>
        </div>
        <div id="reviews" class="tab-content">
          <div class="info-card mb-3 p-3 bg-light rounded border">
            <form id="review-form" class="mb-3">
              <div class="row g-2">
                <div class="col-md-4">
                  <input type="text" id="reviewer-name" class="form-control" placeholder="Nama Anda" required>
                </div>
                <div class="col-md-4">
                  <select id="reviewer-rating" class="form-control" required>
                    <option value="">Rating</option>
                    <option value="5">5 - Sangat Baik</option>
                    <option value="4">4 - Baik</option>
                    <option value="3">3 - Cukup</option>
                    <option value="2">2 - Kurang</option>
                    <option value="1">1 - Buruk</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <input type="file" id="reviewer-avatar" accept="image/*" class="form-control">
                </div>
              </div>
              <textarea id="reviewer-comment" class="form-control mt-2" placeholder="Tulis ulasan Anda..." required></textarea>
              <button type="submit" class="btn btn-success btn-sm mt-2 btn-review-submit">
                <i class="bi bi-send-fill me-1"></i> Kirim Ulasan
              </button>
            </form>
            ${reviewsHTML}
          </div>
        </div>
      `;

      container.innerHTML = `
        <div class="mountain-hero mb-4" style="background-image: url('${imageSrc}');" data-aos="fade-up">
          <div class="difficulty-badge ${difficultyClass}">${mountain.difficulty}</div>
          <div class="price-badge">${new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(mountain.price || 0)}</div>
          <div class="mountain-hero-overlay">
            <h2>${mountain.name}</h2>
            <p><i class="bi bi-geo-alt"></i> ${mountain.location}</p>
          </div>
        </div>
        ${tabsHTML}
      `;
    }

    function renderBookingSidebar(mountain, container) {
        // Default value jika data tidak ada
        const price = mountain.price || 2500000;
        const duration = mountain.duration || "3 Hari 2 Malam";
        const minParticipants = 4;
        const maxParticipants = 20;

        container.innerHTML = `
            <div class="booking-card" data-aos="fade-up" data-aos-delay="100">
                <h5 class="mb-4"><i class="bi bi-calendar-check me-2"></i>Booking Paket</h5>
                
                <!-- Price Info -->
                <div class="text-center mb-4">
                    <div class="h2 text-success mb-0" id="package-price">Rp ${price.toLocaleString('id-ID')}</div>
                    <small class="text-muted">per orang</small>
                </div>

                <!-- Package Details -->
                <div class="mb-4">
                    <h6>Detail Paket:</h6>
                    <ul class="list-unstyled">
                      <li><i class="bi bi-clock text-success"></i> <span id="package-duration">${duration}</span></li>
                      <li><i class="bi bi-people text-success"></i> Min. ${minParticipants} orang</li>
                      <li><i class="bi bi-calendar text-success"></i> Tersedia setiap hari</li>
                      <li><i class="bi bi-shield-check text-success"></i> Asuransi included</li>
                    </ul>
                </div>

                <!-- Date Selection -->
                <div class="mb-4">
                    <label class="form-label">Pilih Tanggal Keberangkatan</label>
                    <input type="date" class="form-control" id="departure-date" min="${new Date().toISOString().split('T')[0]}">
                </div>

                <!-- Participants -->
                <div class="mb-4">
                    <label class="form-label">Jumlah Peserta</label>
                    <div class="input-group">
                      <button class="btn btn-outline-secondary" type="button" id="decrease-participants">-</button>
                      <input type="number" class="form-control text-center" id="participants-count" value="${minParticipants}" min="${minParticipants}" max="${maxParticipants}">
                      <button class="btn btn-outline-secondary" type="button" id="increase-participants">+</button>
                    </div>
                </div>

                <!-- Total Price -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between">
                      <span>Harga per orang:</span>
                      <span id="price-per-person">Rp ${price.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                      <span>Jumlah peserta:</span>
                      <span id="total-participants">${minParticipants} orang</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                      <strong>Total Pembayaran:</strong>
                      <strong id="total-payment">Rp ${(price * minParticipants).toLocaleString('id-ID')}</strong>
                    </div>
                </div>

                <!-- Action Buttons -->
                <button class="btn-book-main" id="book-package-btn">
                    <i class="bi bi-calendar-plus me-2"></i>Pesan Sekarang
                </button>
                <button class="btn-wishlist" id="wishlist-btn">
                    <i class="bi bi-heart me-2"></i>Tambah ke Wishlist
                </button>

                <!-- Contact Info -->
                <div class="mt-4 text-center">
                    <p class="mb-2"><small class="text-muted">Butuh konsultasi?</small></p>
                    <a href="tel:+6281234567890" class="btn btn-outline-success btn-sm me-2">
                      <i class="bi bi-telephone"></i> Hubungi
                    </a>
                    <a href="https://wa.me/6281234567890" class="btn btn-outline-success btn-sm">
                      <i class="bi bi-whatsapp"></i> WhatsApp
                    </a>
                </div>
            </div>
        `;

    // --- Interaktif: Kalkulasi harga otomatis ---
    setTimeout(() => {
      const pricePerPerson = price;
      const min = minParticipants;
      const max = maxParticipants;
      const participantsInput = document.getElementById('participants-count');
      const decreaseBtn = document.getElementById('decrease-participants');
      const increaseBtn = document.getElementById('increase-participants');
      const totalParticipants = document.getElementById('total-participants');
      const totalPayment = document.getElementById('total-payment');

      // Update price and participant count
      const updatePriceDetails = () => {
        const participants = Math.min(Math.max(parseInt(participantsInput.value) || min, min), max);
        totalParticipants.textContent = `${participants} orang`;
        totalPayment.textContent = `Rp ${(pricePerPerson * participants).toLocaleString('id-ID')}`;
      };

      // Decrease participants
      decreaseBtn.addEventListener('click', () => {
        let currentValue = parseInt(participantsInput.value) || min;
        if (currentValue > min) {
          currentValue--;
          participantsInput.value = currentValue;
          updatePriceDetails();
        }
      });

      // Increase participants
      increaseBtn.addEventListener('click', () => {
        let currentValue = parseInt(participantsInput.value) || min;
        if (currentValue < max) {
          currentValue++;
          participantsInput.value = currentValue;
          updatePriceDetails();
        }
      });

      // Initial calculation
      updatePriceDetails();
    }, 100);
    }

    function renderNotFound(container, message = "Maaf, kami tidak dapat menemukan detail untuk paket yang Anda cari.") {
      container.innerHTML = `<div class="row justify-content-center text-center"><div class="col-lg-8"><h3>Paket Tidak Ditemukan</h3><p>${message}</p><a href="katalog-gunung.html" class="btn btn-primary">Kembali ke Katalog</a></div></div>`;
    }
    
    function initializePageFunctionality(mountain) {
        // Initialize tabs
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-tab')).classList.add('active');
            });
        });

        // Initialize Wishlist
        const wishlistBtn = document.getElementById('wishlist-btn');
        wishlistBtn.addEventListener('click', () => toggleWishlist(mountain));
        updateWishlistStatus(mountain);

    // --- Tambah Ulasan ---
    const reviewForm = document.getElementById('review-form');
    if (reviewForm) {
      reviewForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const name = document.getElementById('reviewer-name').value.trim() || 'Anonim';
        const rating = parseInt(document.getElementById('reviewer-rating').value) || 5;
        const comment = document.getElementById('reviewer-comment').value.trim();
        const avatarInput = document.getElementById('reviewer-avatar');
        let avatar = '';
        if (avatarInput && avatarInput.files && avatarInput.files[0]) {
          avatar = await toBase64(avatarInput.files[0]);
        }
        const newReview = { name, rating, comment, avatar };
        // Simpan ke localStorage
        const mountains = JSON.parse(localStorage.getItem('mountains')) || [];
        const idx = mountains.findIndex(m => m.id === mountain.id);
        if (idx !== -1) {
          if (!Array.isArray(mountains[idx].reviews)) mountains[idx].reviews = [];
          mountains[idx].reviews.push(newReview);
          localStorage.setItem('mountains', JSON.stringify(mountains));
          showNotification('success', 'Ulasan berhasil ditambahkan!');
          renderMountainDetails(mountains[idx], document.getElementById('mountain-details-container'));
          initializePageFunctionality(mountains[idx]);
        }
      });
    }

    // --- Tambah Foto Galeri ---
    const galleryForm = document.getElementById('gallery-form');
    if (galleryForm) {
      galleryForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const photoInput = document.getElementById('gallery-photo');
        if (photoInput && photoInput.files && photoInput.files[0]) {
          const photo = await toBase64(photoInput.files[0]);
          const mountains = JSON.parse(localStorage.getItem('mountains')) || [];
          const idx = mountains.findIndex(m => m.id === mountain.id);
          if (idx !== -1) {
            if (!Array.isArray(mountains[idx].gallery)) mountains[idx].gallery = [];
            mountains[idx].gallery.push(photo);
            localStorage.setItem('mountains', JSON.stringify(mountains));
            showNotification('success', 'Foto berhasil ditambahkan ke galeri!');
            renderMountainDetails(mountains[idx], document.getElementById('mountain-details-container'));
            initializePageFunctionality(mountains[idx]);
          }
        }
      });
    }

    // --- Pesan Sekarang (Add to Cart) ---
    const bookBtn = document.getElementById('book-package-btn');
    if (bookBtn) {
      bookBtn.addEventListener('click', function (e) {
        e.preventDefault();

        // Ambil data booking
        const participantsInput = document.getElementById('participants-count');
        const dateInput = document.getElementById('departure-date');
        const participants = parseInt(participantsInput?.value) || 4;
        const date = dateInput?.value || '';

        // Siapkan data produk untuk cart, tambahkan uniqueKey agar setiap klik dianggap produk baru
        const cartItem = {
          id: mountain.id,
          name: mountain.name,
          image: mountain.image || '',
          price: mountain.price || 0,
          quantity: participants,
          date: date,
          category: 'Paket Pendakian',
          duration: mountain.duration || "3 Hari 2 Malam",
          uniqueKey: Date.now() + Math.random().toString(36).substr(2, 9) // unique per klik
        };

        // Ambil cart dari localStorage
        let cart = JSON.parse(localStorage.getItem('cartItems')) || [];
        // Selalu push produk baru (tidak pernah merge)
        cart.push(cartItem);
        localStorage.setItem('cartItems', JSON.stringify(cart));

        showNotification('success', `${mountain.name} berhasil ditambahkan ke keranjang!`);
        updateCartCount();
      });
    }

    // Ganti fungsi updateCartCount agar count = jumlah total produk di semua cart (gunung, porter, gear)
    function updateCartCount() {
      const cartGunung = JSON.parse(localStorage.getItem('cartItems')) || [];
      const cartPorter = JSON.parse(localStorage.getItem('cartPorters')) || [];
      const cartGear = JSON.parse(localStorage.getItem('cartGears')) || [];
      const total = cartGunung.length + cartPorter.length + cartGear.length;
      const cartCountHeader = document.getElementById('cart-count-header');
      if (cartCountHeader) {
        cartCountHeader.textContent = total;
      }
    }

    // Panggil updateCartCount() saat halaman dimuat agar count tetap ada saat refresh
    updateCartCount();
}
    
    // Wishlist Logic
    function toggleWishlist(mountain) {
        let wishlist = JSON.parse(localStorage.getItem('wishlistMountains')) || [];
        const itemIndex = wishlist.findIndex(item => item.id === mountain.id);
        
        if (itemIndex === -1) {
            wishlist.push(mountain);
            showNotification('success', `${mountain.name} ditambahkan ke wishlist!`);
        } else {
            wishlist.splice(itemIndex, 1);
            showNotification('info', `${mountain.name} dihapus dari wishlist.`);
        }
        
        localStorage.setItem('wishlistMountains', JSON.stringify(wishlist));
        updateWishlistStatus(mountain);
        updateWishlistCount();
    }
    
    function updateWishlistStatus(mountain) {
        const wishlist = JSON.parse(localStorage.getItem('wishlistMountains')) || [];
        const isInWishlist = wishlist.some(item => item.id === mountain.id);
        const wishlistBtn = document.getElementById('wishlist-btn');
        if(!wishlistBtn) return;
        const icon = wishlistBtn.querySelector('i');

        if(isInWishlist) {
            wishlistBtn.classList.add('active');
            icon.classList.remove('bi-heart');
            icon.classList.add('bi-heart-fill');
            wishlistBtn.lastChild.nodeValue = " Hapus dari Wishlist";
        } else {
            wishlistBtn.classList.remove('active');
            icon.classList.remove('bi-heart-fill');
            icon.classList.add('bi-heart');
            wishlistBtn.lastChild.nodeValue = " Tambah ke Wishlist";
        }
    }

    function updateWishlistCount() {
        const wishlist = JSON.parse(localStorage.getItem('wishlistMountains')) || [];
        const wishlistCountHeader = document.getElementById('wishlist-count-header');
        if (wishlistCountHeader) {
            wishlistCountHeader.textContent = wishlist.length;
        }
    }
    
    let notificationTimeout;
    function showNotification(type, message) {
        const notification = document.getElementById('custom-notification');
        const iconElement = document.getElementById('notification-icon');
        const messageElement = document.getElementById('notification-message');
        if(!notification || !iconElement || !messageElement) return;

        if (notificationTimeout) clearTimeout(notificationTimeout);

        notification.className = `custom-notification ${type} show`;
        if (type === 'success') iconElement.innerHTML = '<i class="bi bi-check-circle-fill"></i>';
        else if (type === 'error') iconElement.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i>';
        else iconElement.innerHTML = '<i class="bi bi-info-circle-fill"></i>';
        
        messageElement.textContent = message;
        
        notificationTimeout = setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }

    // Initial load
    updateWishlistCount();

    // Helper untuk konversi file ke base64
async function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
  </script>

</body>

</html>
